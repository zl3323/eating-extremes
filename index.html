<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Speed Eating Challenge</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Orbitron', monospace;
      font-weight: 600;
      background: #87CEEB;
      background-image:
        radial-gradient(circle at 25% 25%, #FFE4E6 2px, transparent 2px),
        radial-gradient(circle at 75% 75%, #E0F2F1 2px, transparent 2px);
      background-size: 50px 50px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* Title uses pixel font, rest uses more readable font */
    .title {
      font-family: 'Press Start 2P', monospace;
      font-size: 2.5em;
      color: #FF4500;
      text-shadow: 3px 3px 0px #000;
      margin-bottom: 15px;
      animation: blink 2s infinite;
      line-height: 1.4;
    }

    /* Pixel-style floating emojis */
    .floating-emoji {
      position: absolute;
      font-size: 3.5em;
      animation: float 4s ease-in-out infinite;
      pointer-events: none;
      text-shadow: 2px 2px 0px #000;
    }

    .emoji-1 {
      top: 10%;
      left: 10%;
      animation-delay: 0s;
    }

    .emoji-2 {
      top: 20%;
      right: 15%;
      animation-delay: 1s;
    }

    .emoji-3 {
      top: 70%;
      left: 5%;
      animation-delay: 2s;
    }

    .emoji-4 {
      top: 80%;
      right: 10%;
      animation-delay: 3s;
    }

    .emoji-5 {
      top: 45%;
      left: 3%;
      animation-delay: 2.5s;
    }

    .emoji-6 {
      top: 35%;
      right: 8%;
      animation-delay: 1.5s;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-15px);
      }
    }

    .game-container {
      background: #FFF;
      border: 6px solid #000;
      border-radius: 0;
      box-shadow: 8px 8px 0px #000;
      padding: 35px;
      max-width: 1100px;
      width: 100%;
      margin-bottom: 20px;
      position: relative;
    }

    .game-container::before {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      background: #FFD700;
      border: 3px solid #000;
      z-index: -1;
    }

    .header {
      text-align: center;
      margin-bottom: 35px;
      position: relative;
    }

    @keyframes blink {

      0%,
      50% {
        opacity: 1;
      }

      51%,
      100% {
        opacity: 0.8;
      }
    }

    .subtitle {
      color: #333;
      font-size: 1.4em;
      line-height: 1.6;
      font-weight: 700;
    }

    .game-area {
      display: none;
    }

    .game-area.active {
      display: block;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .start-screen {
      text-align: center;
      padding: 35px 0;
    }

    .welcome-text {
      font-size: 1.6em;
      color: #333;
      margin-bottom: 30px;
      line-height: 1.8;
      font-weight: 700;
    }

    /* Difficulty selector styles */
    .difficulty-selector {
      margin: 30px 0;
      text-align: center;
    }

    .difficulty-label {
      font-size: 1.3em;
      color: #333;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .difficulty-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .difficulty-btn {
      background: #9C27B0;
      color: #FFF;
      border: 4px solid #000;
      padding: 15px 25px;
      font-family: inherit;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.1s ease;
      box-shadow: 4px 4px 0px #000;
      text-shadow: 1px 1px 0px #000;
    }

    .difficulty-btn.selected {
      background: #FF5722;
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0px #000;
    }

    .difficulty-btn:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0px #000;
    }

    .mode-selector {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .mode-btn {
      background: #32CD32;
      color: #FFF;
      border: 4px solid #000;
      padding: 25px 30px;
      font-family: inherit;
      font-size: 1.2em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.1s ease;
      box-shadow: 4px 4px 0px #000;
      text-shadow: 1px 1px 0px #000;
      line-height: 1.5;
      min-width: 180px;
    }

    .mode-btn:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0px #000;
    }

    .mode-btn:active {
      transform: translate(4px, 4px);
      box-shadow: 0px 0px 0px #000;
    }

    .question-area {
      background: #FFEB3B;
      border: 4px solid #000;
      padding: 30px;
      margin: 25px 0;
      position: relative;
      box-shadow: 4px 4px 0px #000;
    }

    .question-area::before {
      content: '‚ùì';
      position: absolute;
      top: -20px;
      left: 20px;
      background: #FF4500;
      padding: 10px;
      border: 3px solid #000;
      font-size: 1.5em;
    }

    .question {
      font-size: 1.5em;
      color: #333;
      margin-bottom: 25px;
      line-height: 1.7;
      text-align: center;
      font-weight: 700;
    }

    /* Difficulty indicator */
    .difficulty-indicator {
      position: absolute;
      top: -20px;
      right: 20px;
      background: #2196F3;
      padding: 8px 15px;
      border: 3px solid #000;
      font-size: 0.9em;
      font-weight: 700;
      color: #FFF;
      text-shadow: 1px 1px 0px #000;
    }

    .options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 18px;
      margin: 25px 0;
    }

    .option-btn {
      background: #2196F3;
      color: #FFF;
      border: 4px solid #000;
      padding: 18px 25px;
      font-family: inherit;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.1s ease;
      box-shadow: 4px 4px 0px #000;
      text-shadow: 1px 1px 0px #000;
      line-height: 1.5;
      min-height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .option-btn:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0px #000;
    }

    .option-btn.correct {
      background: #4CAF50;
      animation: correctShake 0.5s ease;
    }

    .option-btn.incorrect {
      background: #F44336;
      animation: incorrectShake 0.5s ease;
    }

    @keyframes correctShake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-4px);
      }

      75% {
        transform: translateX(4px);
      }
    }

    @keyframes incorrectShake {

      0%,
      100% {
        transform: translateX(0);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: translateX(-2px);
      }

      20%,
      40%,
      60%,
      80% {
        transform: translateX(2px);
      }
    }

    .feedback {
      margin-top: 25px;
      padding: 20px;
      border: 4px solid #000;
      font-size: 1.1em;
      text-align: center;
      display: none;
      box-shadow: 4px 4px 0px #000;
      line-height: 1.6;
      font-weight: 600;
    }

    .feedback.correct {
      background: #C8E6C9;
      color: #2E7D32;
    }

    .feedback.incorrect {
      background: #FFCDD2;
      color: #C62828;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      background: #9C27B0;
      color: #FFF;
      padding: 25px;
      border: 4px solid #000;
      margin: 25px 0;
      box-shadow: 4px 4px 0px #000;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 2em;
      display: block;
      text-shadow: 2px 2px 0px #000;
      font-weight: 900;
    }

    .stat-label {
      font-size: 0.9em;
      margin-top: 8px;
      opacity: 0.95;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .controls {
      text-align: center;
      margin-top: 30px;
    }

    .btn {
      background: #FF5722;
      color: #FFF;
      border: 4px solid #000;
      padding: 15px 30px;
      font-family: inherit;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      margin: 0 10px;
      transition: all 0.1s ease;
      box-shadow: 4px 4px 0px #000;
      text-shadow: 1px 1px 0px #000;
      letter-spacing: 0.5px;
    }

    .btn:hover {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0px #000;
    }

    .btn:active {
      transform: translate(4px, 4px);
      box-shadow: 0px 0px 0px #000;
    }

    /* Sound toggle button */
    .sound-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #673AB7;
      color: #FFF;
      border: 3px solid #000;
      padding: 10px 15px;
      font-family: inherit;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 3px 3px 0px #000;
      transition: all 0.1s ease;
    }

    .sound-toggle:hover {
      transform: translate(1px, 1px);
      box-shadow: 2px 2px 0px #000;
    }

    .sound-toggle.muted {
      background: #757575;
    }

    .final-screen {
      text-align: center;
      padding: 40px 0;
    }

    .final-screen h2 {
      font-size: 2em;
      margin-bottom: 25px;
      color: #333;
      font-weight: 900;
    }

    .final-score {
      font-size: 2.5em;
      color: #FF4500;
      text-shadow: 3px 3px 0px #000;
      margin: 25px 0;
      font-weight: 900;
    }

    .performance-msg {
      font-size: 1.3em;
      color: #333;
      margin: 25px 0;
      line-height: 1.7;
      font-weight: 600;
      padding: 0 20px;
    }

    /* Review section styles */
    .review-section {
      background: #E3F2FD;
      border: 4px solid #000;
      padding: 25px;
      margin: 25px 0;
      box-shadow: 4px 4px 0px #000;
      max-height: 400px;
      overflow-y: auto;
      text-align: left;
    }

    .review-title {
      font-size: 1.4em;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      text-align: center;
    }

    .review-item {
      background: #FFF;
      border: 2px solid #000;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 2px 2px 0px #000;
    }

    .review-question {
      font-size: 1.1em;
      font-weight: 700;
      color: #333;
      margin-bottom: 10px;
    }

    .review-your-answer {
      font-size: 1em;
      color: #666;
      margin: 5px 0;
    }

    .review-correct-answer {
      font-size: 1em;
      color: #2E7D32;
      margin: 5px 0;
      font-weight: 600;
    }

    .review-status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 0.9em;
      font-weight: 700;
      margin-left: 10px;
    }

    .review-status.correct {
      background: #C8E6C9;
      color: #2E7D32;
    }

    .review-status.incorrect {
      background: #FFCDD2;
      color: #C62828;
    }

    .sentence-builder {
      background: #E1F5FE;
      border: 4px solid #000;
      padding: 25px;
      margin: 25px 0;
      box-shadow: 4px 4px 0px #000;
    }

    .word-bank {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 25px;
    }

    .word-card {
      background: #673AB7;
      color: #FFF;
      padding: 12px 18px;
      border: 3px solid #000;
      cursor: pointer;
      transition: all 0.1s ease;
      font-size: 1.1em;
      font-weight: 600;
      box-shadow: 3px 3px 0px #000;
      text-shadow: 1px 1px 0px #000;
    }

    .word-card:hover {
      transform: translate(1px, 1px);
      box-shadow: 2px 2px 0px #000;
    }

    .word-card.used {
      background: #757575;
      cursor: not-allowed;
      transform: translate(3px, 3px);
      box-shadow: 0px 0px 0px #000;
    }

    .sentence-area {
      background: #FFF;
      border: 3px dashed #000;
      padding: 25px;
      min-height: 80px;
      margin: 20px 0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      font-size: 1.1em;
    }

    .placed-word {
      background: #4CAF50;
      color: #FFF;
      padding: 10px 16px;
      border: 2px solid #000;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      box-shadow: 2px 2px 0px #000;
      text-shadow: 1px 1px 0px #000;
    }

    .placed-word:hover {
      transform: translate(1px, 1px);
      box-shadow: 1px 1px 0px #000;
    }

    /* Translation exercise styles */
    .translation-input {
      background: #FFF;
      border: 4px solid #000;
      padding: 15px;
      font-family: inherit;
      font-size: 1.2em;
      font-weight: 600;
      width: 100%;
      margin: 15px 0;
      box-shadow: inset 2px 2px 0px #CCC;
    }

    .translation-input:focus {
      outline: none;
      box-shadow: inset 2px 2px 0px #000;
    }

    .chinese-text {
      background: #FFF3E0;
      border: 3px solid #000;
      padding: 20px;
      margin: 15px 0;
      font-size: 1.6em;
      color: #333;
      box-shadow: 2px 2px 0px #000;
      font-weight: 700;
    }

    /* Match exercise styles */
    .matching-area {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin: 25px 0;
    }

    .match-column {
      background: #E8F5E8;
      border: 3px solid #000;
      padding: 20px;
      box-shadow: 3px 3px 0px #000;
    }

    .match-column h3 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.2em;
      font-weight: 700;
      color: #333;
    }

    .match-item {
      background: #FFF;
      border: 2px solid #000;
      padding: 14px;
      margin: 10px 0;
      cursor: pointer;
      font-size: 1.05em;
      font-weight: 600;
      transition: all 0.1s ease;
      box-shadow: 2px 2px 0px #000;
      line-height: 1.5;
      min-height: 50px;
      display: flex;
      align-items: center;
    }

    .match-item:hover {
      transform: translate(1px, 1px);
      box-shadow: 1px 1px 0px #000;
    }

    .match-item.selected {
      background: #FFEB3B;
      border-color: #FF5722;
      border-width: 3px;
    }

    .match-item.matched {
      background: #C8E6C9;
      cursor: not-allowed;
    }

    /* Power-up effects */
    .power-up {
      position: fixed;
      font-size: 2.5em;
      pointer-events: none;
      z-index: 1000;
      animation: powerUpFloat 2s ease-out forwards;
      font-weight: 900;
    }

    @keyframes powerUpFloat {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }

      100% {
        transform: translateY(-50px) scale(1.5);
        opacity: 0;
      }
    }

    @media (max-width: 768px) {
      .game-container {
        padding: 25px;
        margin: 10px;
      }

      .title {
        font-size: 1.5em;
      }

      .subtitle {
        font-size: 1.1em;
      }

      .welcome-text {
        font-size: 1.3em;
      }

      .mode-selector {
        flex-direction: column;
        align-items: center;
      }

      .mode-btn {
        font-size: 1em;
        padding: 20px 25px;
        width: 100%;
        max-width: 300px;
      }

      .question {
        font-size: 1.2em;
      }

      .option-btn {
        font-size: 0.95em;
        padding: 15px 20px;
        min-height: 60px;
      }

      .stats {
        padding: 20px;
      }

      .stat-number {
        font-size: 1.6em;
      }

      .stat-label {
        font-size: 0.8em;
      }

      .floating-emoji {
        display: none;
      }

      .matching-area {
        grid-template-columns: 1fr;
      }

      .match-item {
        font-size: 0.95em;
      }

      .chinese-text {
        font-size: 1.3em;
      }

      .translation-input {
        font-size: 1em;
      }

      .btn {
        font-size: 0.95em;
        padding: 12px 20px;
        margin: 5px;
      }

      .feedback {
        font-size: 0.95em;
      }

      .performance-msg {
        font-size: 1.1em;
      }

      .sound-toggle {
        position: static;
        margin-bottom: 20px;
      }

      .difficulty-buttons {
        flex-direction: column;
        align-items: center;
      }

      .difficulty-btn {
        width: 200px;
      }
    }
  </style>
</head>

<body>
  <!-- Sound toggle button -->
  <button class="sound-toggle" id="sound-toggle" onclick="toggleSound()">üîä Sound On</button>

  <!-- Floating emoji decorations -->
  <div class="floating-emoji emoji-1">üçï</div>
  <div class="floating-emoji emoji-2">üå≠</div>
  <div class="floating-emoji emoji-3">üç¶</div>
  <div class="floating-emoji emoji-4">üå∂Ô∏è</div>
  <div class="floating-emoji emoji-5">üèÜ</div>
  <div class="floating-emoji emoji-6">‚ö°</div>

  <div class="game-container">
    <div class="header">
      <h1 class="title">üçî SPEED EATING CHALLENGE üèÜ</h1>
      <p class="subtitle">Welcome to Culver's Classroom</p>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="game-area active">
      <div class="start-screen">
        <div class="welcome-text">Select Your Challenge Mode!</div>

        <!-- Difficulty selector -->
        <div class="difficulty-selector">
          <div class="difficulty-label">Choose Difficulty:</div>
          <div class="difficulty-buttons">
            <button class="difficulty-btn" onclick="selectDifficulty('easy')">Easy</button>
            <button class="difficulty-btn selected" onclick="selectDifficulty('medium')">Medium</button>
            <button class="difficulty-btn" onclick="selectDifficulty('hard')">Hard</button>
          </div>
        </div>

        <div class="mode-selector">
          <button class="mode-btn" onclick="startGame('vocabulary')">
            üìö<br>Vocabulary<br>Master
          </button>
          <button class="mode-btn" onclick="startGame('grammar')">
            ‚ö°<br>Grammar<br>Builder
          </button>
          <button class="mode-btn" onclick="startGame('reading')">
            üìñ<br>Reading<br>Champion
          </button>
          <button class="mode-btn" onclick="startGame('translation')">
            üåç<br>Translation<br>Expert
          </button>
          <button class="mode-btn" onclick="startGame('matching')">
            üéØ<br>Word<br>Matcher
          </button>
        </div>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="game-area">
      <div class="stats">
        <div class="stat-item">
          <span class="stat-number" id="score">0</span>
          <div class="stat-label">Score</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="question-num">1</span>
          <div class="stat-label">Question</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="timer">45</span>
          <div class="stat-label">Time</div>
        </div>
      </div>

      <div class="question-area">
        <div class="difficulty-indicator" id="difficulty-indicator"></div>
        <div class="question" id="question-text"></div>
        <div id="options-container" class="options"></div>
        <div id="sentence-builder" class="sentence-builder" style="display: none;">
          <div class="word-bank" id="word-bank"></div>
          <div class="sentence-area" id="sentence-area">
            <span style="color: #666; font-style: italic;">Click Words to Build Sentence...</span>
          </div>
        </div>
        <div id="translation-area" class="translation-area" style="display: none;">
          <div class="chinese-text" id="chinese-text"></div>
          <input type="text" class="translation-input" id="translation-input" placeholder="TYPE YOUR ENGLISH TRANSLATION HERE...">
        </div>
        <div id="matching-area" class="matching-area" style="display: none;">
          <div class="match-column" id="left-column">
            <h3>Words</h3>
          </div>
          <div class="match-column" id="right-column">
            <h3>Meanings</h3>
          </div>
        </div>
        <div id="feedback" class="feedback"></div>
      </div>

      <div class="controls">
        <button class="btn" onclick="checkAnswer()">Check Answer</button>
        <button class="btn" onclick="nextQuestion()">Next</button>
        <button class="btn" onclick="endGame()">Finish</button>
      </div>
    </div>

    <!-- Final Screen -->
    <div id="final-screen" class="game-area">
      <div class="final-screen">
        <h2>üéâ GAME COMPLETE! üéâ</h2>
        <div class="final-score" id="final-score">0</div>
        <div class="performance-msg" id="performance-msg"></div>

        <!-- Review Section -->
        <div class="review-section" id="review-section">
          <div class="review-title">üìù Review Your Answers</div>
          <div id="review-content"></div>
        </div>

        <button class="btn" onclick="restartGame()">Play Again</button>
        <button class="btn" onclick="showStartScreen()">Main Menu</button>
      </div>
    </div>
  </div>

  <script>
    // Game variables
    let currentMode = '';
    let currentQuestionIndex = 0;
    let score = 0;
    let timer = 45;
    let timerInterval;
    let questions = [];
    let currentSentence = [];
    let selectedMatches = [];
    let soundEnabled = true;
    let selectedDifficulty = 'medium';
    let answersHistory = [];
    // Sound effects using Web Audio API
    const audioContext = new(window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
      if (!soundEnabled) return;
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      const now = audioContext.currentTime;
      switch (type) {
        case 'correct':
          oscillator.frequency.setValueAtTime(523.25, now); // C5
          oscillator.frequency.setValueAtTime(659.25, now + 0.1); // E5
          oscillator.frequency.setValueAtTime(783.99, now + 0.2); // G5
          gainNode.gain.setValueAtTime(0.3, now);
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
          oscillator.start(now);
          oscillator.stop(now + 0.3);
          break;
        case 'incorrect':
          oscillator.frequency.setValueAtTime(293.66, now); // D4
          oscillator.frequency.setValueAtTime(261.63, now + 0.15); // C4
          gainNode.gain.setValueAtTime(0.3, now);
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
          oscillator.start(now);
          oscillator.stop(now + 0.3);
          break;
        case 'click':
          oscillator.frequency.setValueAtTime(800, now);
          gainNode.gain.setValueAtTime(0.1, now);
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
          oscillator.start(now);
          oscillator.stop(now + 0.05);
          break;
        case 'powerup':
          oscillator.frequency.setValueAtTime(440, now); // A4
          oscillator.frequency.exponentialRampToValueAtTime(880, now + 0.2); // A5
          gainNode.gain.setValueAtTime(0.2, now);
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
          oscillator.start(now);
          oscillator.stop(now + 0.3);
          break;
        case 'gameOver':
          oscillator.frequency.setValueAtTime(523.25, now); // C5
          oscillator.frequency.setValueAtTime(392, now + 0.1); // G4
          oscillator.frequency.setValueAtTime(261.63, now + 0.2); // C4
          oscillator.frequency.setValueAtTime(523.25, now + 0.3); // C5
          gainNode.gain.setValueAtTime(0.3, now);
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
          oscillator.start(now);
          oscillator.stop(now + 0.5);
          break;
      }
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      const button = document.getElementById('sound-toggle');
      if (soundEnabled) {
        button.textContent = 'üîä Sound On';
        button.classList.remove('muted');
      } else {
        button.textContent = 'üîá Sound Off';
        button.classList.add('muted');
      }
      playSound('click');
    }

    function selectDifficulty(difficulty) {
      selectedDifficulty = difficulty;
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      event.target.classList.add('selected');
      playSound('click');
    }
    // Comprehensive question banks with difficulty levels
    const vocabularyQuestions = [
      // Easy questions
      {
        question: "What does 'prize' mean?",
        options: ["Something you win when successful", "Something you lose", "Something you buy", "Something you throw away"],
        correct: 0,
        explanation: "A prize is something you win when you are successful in a competition.",
        difficulty: "easy"
      },
      {
        question: "What does 'contestants' mean?",
        options: ["People who watch competitions", "People who judge competitions", "People who organize competitions", "People who participate in competitions"],
        correct: 3,
        explanation: "Contestants are people who participate in eating competitions.",
        difficulty: "easy"
      },
      {
        question: "What does 'tradition' mean?",
        options: ["Something new", "Something forgotten", "Something people do every year", "Something impossible"],
        correct: 2,
        explanation: "A tradition is something that people do regularly every year, passed down over time.",
        difficulty: "easy"
      },
      {
        question: "What does 'unhealthy' mean?",
        options: ["Delicious", "Very good for health", "Not good for your body", "Expensive"],
        correct: 2,
        explanation: "Unhealthy means not good for your body or health.",
        difficulty: "easy"
      },
      {
        question: "What does 'current champion' mean?",
        options: ["Past winner", "Future winner", "Present winner", "Someone who lost"],
        correct: 2,
        explanation: "Current champion means the present or most recent winner of the competition.",
        difficulty: "easy"
      },
      // Medium questions
      {
        question: "What does 'competitive eating' mean?",
        options: ["Cooking food fast", "Contestants eat as much as they can within a time limit", "Watching people eat", "Learning about food"],
        correct: 1,
        explanation: "Competitive eating is exactly what its name suggests - contestants eat as much as they can, usually within a time limit.",
        difficulty: "medium"
      },
      {
        question: "What does 'various' mean in the context of eating competitions?",
        options: ["Same types", "One type only", "No types", "Different kinds"],
        correct: 3,
        explanation: "Various means different kinds - eating competitions can involve various foods like pizza, pies, ice cream, chili peppers.",
        difficulty: "medium"
      },
      {
        question: "What does 'time limit' mean?",
        options: ["Unlimited time", "Only a short time allowed", "Long time", "No time restrictions"],
        correct: 1,
        explanation: "Time limit means only a short amount of time is allowed for the competition.",
        difficulty: "medium"
      },
      {
        question: "According to the legend, what does 'argue' mean?",
        options: ["To have a discussion with disagreement", "To agree completely", "To stay quiet", "To run away"],
        correct: 0,
        explanation: "To argue means to have a discussion where people disagree with each other.",
        difficulty: "medium"
      },
      {
        question: "What does 'immigrant' mean?",
        options: ["Someone who stays in the same place", "Someone who moves to another country", "Someone who visits places", "Someone who never travels"],
        correct: 1,
        explanation: "An immigrant is someone who moves to live in another country permanently.",
        difficulty: "medium"
      },
      // Hard questions
      {
        question: "What does 'exactly' mean in 'exactly what its name suggests'?",
        options: ["Never", "Maybe", "Precisely", "Sometimes"],
        correct: 2,
        explanation: "'Exactly' means precisely - competitive eating is exactly (precisely) what its name suggests.",
        difficulty: "hard"
      },
      {
        question: "What does 'work out' mean in 'worked out a way'?",
        options: ["Exercise", "Give up", "Make it harder", "Find a solution"],
        correct: 3,
        explanation: "'Work out' means to find a solution or figure out how to solve a problem.",
        difficulty: "hard"
      },
      {
        question: "What does 'hold the world record' mean?",
        options: ["Carry something heavy", "Keep a secret", "Stop something", "Have the best achievement ever"],
        correct: 3,
        explanation: "To hold the world record means to have achieved the best performance that has ever been recorded.",
        difficulty: "hard"
      },
      {
        question: "What does 'doesn't look like' mean when describing Kobayashi?",
        options: ["Appears to be", "Doesn't appear to be", "Definitely is", "Always is"],
        correct: 1,
        explanation: "'Doesn't look like' means doesn't appear to be - Kobayashi doesn't appear to be a typical eating champion.",
        difficulty: "hard"
      },
      {
        question: "What does 'go hungry' mean?",
        options: ["Eat too much", "Don't have enough food to eat", "Cook food", "Buy food"],
        correct: 1,
        explanation: "Go hungry means to not have enough food to eat.",
        difficulty: "hard"
      }
    ];
    const grammarQuestions = [
      // Easy questions
      {
        question: "Complete: 'Joey Chestnut ___ American'",
        options: ["are", "am", "be", "is"],
        correct: 3,
        explanation: "Joey Chestnut (singular) uses 'is' - this is the linking verb 'be' + adjective pattern.",
        difficulty: "easy"
      },
      {
        question: "Complete: 'Kobayashi ___ from Japan'",
        options: ["are", "is", "am", "be"],
        correct: 1,
        explanation: "Kobayashi (singular) + is (linking verb) + from Japan (prepositional phrase)",
        difficulty: "easy"
      },
      {
        question: "Identify the subject in: 'James Mullen won the eating contest'",
        options: ["won", "the eating contest", "James Mullen", "eating"],
        correct: 2,
        explanation: "James Mullen is the subject - he is the person performing the action.",
        difficulty: "easy"
      },
      {
        question: "Identify the verb in: 'The contest started a tradition'",
        options: ["started", "The contest", "a tradition", "tradition"],
        correct: 0,
        explanation: "'Started' is the verb - it shows the action that the subject performed.",
        difficulty: "easy"
      },
      // Medium questions
      {
        question: "Build an SVO sentence",
        type: "sentence-builder",
        words: ["Contestants", "eat", "food", "many", "much", "their"],
        correctSentence: ["Contestants", "eat", "food"],
        explanation: "Contestants (Subject) + eat (Verb) + food (Object) - This is a basic SVO sentence structure.",
        difficulty: "medium"
      },
      {
        question: "Identify the correct SVO sentence:",
        options: ["Eating competitions can offer large prizes", "Can offer eating competitions prizes", "Prizes eating competitions offer", "Offer competitions eating prizes"],
        correct: 0,
        explanation: "Eating competitions (S) + can offer (V) + large prizes (O) - This follows the SVO pattern.",
        difficulty: "medium"
      },
      {
        question: "Which sentence uses the correct 'be + adjective' pattern?",
        options: ["He smaller than Chestnut", "He is smaller than Chestnut", "He are smaller than Chestnut", "He be smaller than Chestnut"],
        correct: 1,
        explanation: "He (subject) + is (linking verb) + smaller (adjective) - this is the correct 'be + adjective' pattern.",
        difficulty: "medium"
      },
      // Hard questions
      {
        question: "Build an SVO sentence",
        type: "sentence-builder",
        words: ["Eating", "competitions", "can", "offer", "large", "prizes", "winners"],
        correctSentence: ["Eating", "competitions", "can", "offer", "large", "prizes"],
        explanation: "Eating competitions (S) + can offer (V) + large prizes (O)",
        difficulty: "hard"
      },
      {
        question: "Build an SVO sentence",
        type: "sentence-builder",
        words: ["They", "worked", "out", "a", "way", "has", "problem"],
        correctSentence: ["They", "worked", "out", "a", "way"],
        explanation: "They (S) + worked out (V) + a way (O)",
        difficulty: "hard"
      },
      {
        question: "Which is the correct sentence order?",
        options: ["Chestnut the current champion is", "Is Chestnut the current champion", "The current champion is Chestnut", "Champion the current is Chestnut"],
        correct: 2,
        explanation: "The current champion (subject) + is (linking verb) + Chestnut (noun) - correct linking verb pattern.",
        difficulty: "hard"
      }
    ];
    const readingQuestions = [
      // Easy questions
      {
        question: "Where is Nathan's Famous Hot Dog Contest held?",
        options: ["Washington D.C.", "Chicago", "Los Angeles", "Coney Island, New York"],
        correct: 3,
        explanation: "According to the text, the contest is held in Coney Island, New York every July 4th.",
        difficulty: "easy"
      },
      {
        question: "What types of food are mentioned in eating competitions?",
        options: ["Only hot dogs", "Just vegetables", "Pizza, pies, ice cream, chili peppers", "Only desserts"],
        correct: 2,
        explanation: "The text mentions eating competitions can involve various foods - pizza, pies, ice cream, chili peppers.",
        difficulty: "easy"
      },
      {
        question: "When did Kobayashi first win the Nathan's contest?",
        options: ["2000", "2001", "2002", "2003"],
        correct: 1,
        explanation: "Kobayashi first won the event in 2001 when he was 23 years old.",
        difficulty: "easy"
      },
      // Medium questions
      {
        question: "What are the basic elements mentioned for understanding an article?",
        options: ["Only text", "Title, photos, subheadings, captions", "Just pictures", "Only the conclusion"],
        correct: 1,
        explanation: "Article elements include title, photos, subheadings, sidebar, captions, footnotes - these help you understand the article.",
        difficulty: "medium"
      },
      {
        question: "How many hot dogs did Joey Chestnut eat to set his world record?",
        options: ["70", "72", "74", "76"],
        correct: 2,
        explanation: "Joey Chestnut holds the world record for eating 74 hot dogs in less than 10 minutes.",
        difficulty: "medium"
      },
      {
        question: "Who was the Nathan's Contest champion for many years before?",
        options: ["James Mullen", "Takeru Kobayashi", "Nathan's founder", "An Irish immigrant"],
        correct: 1,
        explanation: "For many years, the Nathan's Contest champion was Takeru Kobayashi from Japan.",
        difficulty: "medium"
      },
      {
        question: "According to the legend, who won the first contest over 100 years ago?",
        options: ["James Mullen", "Joey Chestnut", "Takeru Kobayashi", "Nathan himself"],
        correct: 0,
        explanation: "According to the legend, James Mullen, an Irish immigrant, won the first contest over 100 years ago.",
        difficulty: "medium"
      },
      {
        question: "How is Kobayashi described compared to Chestnut?",
        options: ["Bigger and stronger", "Taller and faster", "Same size", "Smaller and lighter"],
        correct: 3,
        explanation: "The text says 'He is smaller and lighter than Chestnut, and doesn't look like an eating champion.'",
        difficulty: "medium"
      },
      // Hard questions
      {
        question: "According to the text, that's just over how many seconds per hot dog?",
        options: ["8 seconds", "6 seconds", "10 seconds", "12 seconds"],
        correct: 0,
        explanation: "The text states 'That's just over 8 seconds per hot dog' for Joey Chestnut's record.",
        difficulty: "hard"
      },
      {
        question: "Why do some people think eating competitions are 'in bad taste'?",
        options: ["They're boring", "They can be unhealthy and many people go hungry", "They're too expensive", "They're not real sports"],
        correct: 1,
        explanation: "The text says 'It can be unhealthy for the contestants, and many people in the world are going hungry.'",
        difficulty: "hard"
      },
      {
        question: "How do competitive eaters view themselves according to Kobayashi?",
        options: ["As entertainers", "As comedians", "As teachers", "As athletes"],
        correct: 3,
        explanation: "As Kobayashi says, 'Food fighters... think of themselves as athletes.'",
        difficulty: "hard"
      },
      {
        question: "What is the main question about eating competitions in the final paragraph?",
        options: ["Are they expensive?", "Are they difficult?", "Are they in bad taste?", "Are they popular?"],
        correct: 2,
        explanation: "The text asks 'So are eating competitions in bad taste?' - this is the main question about whether they are appropriate.",
        difficulty: "hard"
      }
    ];
    const translationQuestions = [
      // Easy questions
      {
        question: "Translate to English:",
        chinese: "‰ªñËµ¢‰∫ÜËøô‰∏™ÊØîËµõ„ÄÇ",
        type: "translation",
        correctAnswers: ["He won this competition.", "He won the competition.", "He won this contest."],
        explanation: "‰ªñ (he) + Ëµ¢‰∫Ü (won) + Ëøô‰∏™ÊØîËµõ (this competition)",
        difficulty: "easy"
      },
      {
        question: "Translate to English:",
        chinese: "ÊàëÊÉ≥Ëµ¢ÂæóËøô‰∏™Â•ñÂìÅ„ÄÇ",
        type: "translation",
        correctAnswers: ["I want to win this prize.", "I want to win the prize."],
        explanation: "Êàë (I) + ÊÉ≥ (want to) + Ëµ¢Âæó (win) + Ëøô‰∏™ (this) + Â•ñÂìÅ (prize)",
        difficulty: "easy"
      },
      // Medium questions
      {
        question: "Translate to English:",
        chinese: "Â•πÊòØÊØîËµõ‰∏≠ÊúÄÂπ¥ËΩªÁöÑÂèÇËµõËÄÖ„ÄÇ",
        type: "translation",
        correctAnswers: ["She is the youngest contestant in the competition.", "She is the youngest contestant in the contest.", "She's the youngest contestant in the competition."],
        explanation: "Â•π (she) + ÊòØ (is) + ÊúÄÂπ¥ËΩªÁöÑ (youngest) + ÂèÇËµõËÄÖ (contestant) + Âú®ÊØîËµõ‰∏≠ (in the competition)",
        difficulty: "medium"
      },
      {
        question: "Translate to English:",
        chinese: "ÊØîËµõÊó∂Èó¥Âè™ÊúâÂçÅÂàÜÈíü„ÄÇ",
        type: "translation",
        correctAnswers: ["The time limit of the competition is only ten minutes.", "The contest time is only ten minutes.", "The time limit is only ten minutes."],
        explanation: "ÊØîËµõÊó∂Èó¥ (the time limit of the competition) + Âè™Êúâ (is only) + ÂçÅÂàÜÈíü (ten minutes)",
        difficulty: "medium"
      },
      {
        question: "Translate to English:",
        chinese: "Ëé∑ËÉúËÄÖËÉΩÂæóÂà∞ÂæàÂ§ßÁöÑÂ•ñÂìÅ„ÄÇ",
        type: "translation",
        correctAnswers: ["Winners can get large prizes.", "The winner can get a large prize.", "Winners can get big prizes.", "The winner can get a big prize."],
        explanation: "Ëé∑ËÉúËÄÖ (winners) + ËÉΩ (can) + ÂæóÂà∞ (get/receive) + ÂæàÂ§ßÁöÑ (large) + Â•ñÂìÅ (prizes)",
        difficulty: "medium"
      },
      {
        question: "Translate to English:",
        chinese: "ËøôÊòØ‰∏Ä‰∏™ÁôæÂπ¥‰º†Áªü„ÄÇ",
        type: "translation",
        correctAnswers: ["This is a hundred-year tradition.", "This is a century-old tradition.", "This is a 100-year tradition."],
        explanation: "ËøôÊòØ (this is) + ‰∏Ä‰∏™ (a) + ÁôæÂπ¥ (hundred-year/century-old) + ‰º†Áªü (tradition)",
        difficulty: "medium"
      },
      // Hard questions
      {
        question: "Translate to English:",
        chinese: "‰ªñÂêÉÁöÑÂíåÊàë‰∏ÄÊ†∑Â§ö„ÄÇ",
        type: "translation",
        correctAnswers: ["He eats as much as I do."],
        explanation: "‰ªñ (he) + ÂêÉÁöÑ (eats) + ÂíåÊàë‰∏ÄÊ†∑Â§ö (as much as I do) - using the 'as...as' pattern",
        difficulty: "hard"
      },
      {
        question: "Translate to English:",
        chinese: "ÊØîËµõËÄÖÂú®Êó∂Èó¥ÈôêÂà∂ÂÜÖÂêÉÂæàÂ§öÈ£üÁâ©„ÄÇ",
        type: "translation",
        correctAnswers: ["Contestants eat a lot of food within the time limit.", "The contestants eat much food within the time limit."],
        explanation: "ÊØîËµõËÄÖ (contestants) + ÂêÉ (eat) + ÂæàÂ§öÈ£üÁâ© (a lot of food) + Âú®Êó∂Èó¥ÈôêÂà∂ÂÜÖ (within the time limit)",
        difficulty: "hard"
      },
      {
        question: "Translate to English:",
        chinese: "ÊØîËµõÂåÖÂê´ÂæàÂ§öÁßçÁ±ªÁöÑÈ£üÁâ©„ÄÇ",
        type: "translation",
        correctAnswers: ["The competition includes many types of food.", "The competition includes different types of food.", "The competition includes different kinds of food.", "The competition includes various foods.", "The contest includes various foods.", "The contest includes different kinds of food.", "The contest includes many types of food.", "The contest includes different types of food."],
        explanation: "ÊØîËµõ (The competition) + ÂåÖÂê´ (includes) + ÂæàÂ§öÁßçÁ±ªÁöÑ (many types of) + È£üÁâ© (food)",
        difficulty: "hard"
      },
      {
        question: "Translate to English:",
        chinese: "‰ªñ‰ª¨‰∫âËÆ∫Ë∞ÅÊõ¥Áà±Ëøô‰∏™ÂõΩÂÆ∂„ÄÇ",
        type: "translation",
        correctAnswers: ["They argued about who loved their country more.", "They argue for who loves the country more."],
        explanation: "‰ªñ‰ª¨ (they) + ‰∫âËÆ∫ (argued) + Ë∞Å (who) + Êõ¥Áà± (loved more) + Ëøô‰∏™ÂõΩÂÆ∂ (the/their country)",
        difficulty: "hard"
      }
    ];
    const matchingQuestions = [
      // Easy questions
      {
        question: "Match the words with their correct meanings:",
        type: "matching",
        pairs: [{
            word: "contestant",
            meaning: "a person in a competition"
          },
          {
            word: "prize",
            meaning: "something you win when successful"
          },
          {
            word: "tradition",
            meaning: "something people do every year"
          }
        ],
        explanation: "These are basic vocabulary words from the competitive eating text.",
        difficulty: "easy"
      },
      // Medium questions
      {
        question: "Match the words with their correct meanings:",
        type: "matching",
        pairs: [{
            word: "contestant",
            meaning: "a person in a competition"
          },
          {
            word: "record",
            meaning: "the best number ever achieved"
          },
          {
            word: "prize",
            meaning: "something you win when successful"
          },
          {
            word: "time limit",
            meaning: "only a short time allowed"
          },
          {
            word: "various",
            meaning: "different kinds of things"
          }
        ],
        explanation: "These are key vocabulary words from the competitive eating text with their definitions.",
        difficulty: "medium"
      },
      {
        question: "Match the people with their descriptions:",
        type: "matching",
        pairs: [{
            word: "Joey Chestnut",
            meaning: "current champion, holds world record for 74 hot dogs"
          },
          {
            word: "Takeru Kobayashi",
            meaning: "former champion from Japan, smaller and lighter"
          },
          {
            word: "James Mullen",
            meaning: "Irish immigrant who won the first contest"
          },
          {
            word: "Nathan's Contest",
            meaning: "famous hot dog eating competition"
          }
        ],
        explanation: "These are the key people and competition mentioned in the reading passage.",
        difficulty: "medium"
      },
      // Hard questions
      {
        question: "Match the words with their correct meanings:",
        type: "matching",
        pairs: [{
            word: "argue",
            meaning: "to have a discussion with disagreement"
          },
          {
            word: "legend",
            meaning: "a story that may not be completely true"
          },
          {
            word: "immigrant",
            meaning: "someone who moves to another country"
          },
          {
            word: "work out",
            meaning: "to find a solution"
          },
          {
            word: "tradition",
            meaning: "something people do every year"
          }
        ],
        explanation: "These vocabulary words relate to the legend of how the hot dog contest started.",
        difficulty: "hard"
      },
      {
        question: "Match the sentence parts (Subject-Verb-Object):",
        type: "matching",
        pairs: [{
            word: "Contestants",
            meaning: "eat as much as they can"
          },
          {
            word: "Eating competitions",
            meaning: "can offer large prizes"
          },
          {
            word: "Joey Chestnut",
            meaning: "holds the world record"
          },
          {
            word: "Takeru Kobayashi",
            meaning: "was the champion for many years"
          }
        ],
        explanation: "Practice matching subjects with their corresponding verb phrases and objects.",
        difficulty: "hard"
      },
      {
        question: "Match the grammar patterns:",
        type: "matching",
        pairs: [{
            word: "Joey Chestnut is American",
            meaning: "Subject + be + adjective"
          },
          {
            word: "He is smaller than Chestnut",
            meaning: "Subject + be + adjective"
          },
          {
            word: "Contestants eat food",
            meaning: "Subject + verb + object"
          },
          {
            word: "They worked out a way",
            meaning: "Subject + phrasal verb + object"
          }
        ],
        explanation: "These show different sentence patterns: SVO and linking verb structures.",
        difficulty: "hard"
      }
    ];

    function createPowerUp(text, x, y) {
      const powerUp = document.createElement('div');
      powerUp.className = 'power-up';
      powerUp.textContent = text;
      powerUp.style.left = x + 'px';
      powerUp.style.top = y + 'px';
      document.body.appendChild(powerUp);
      playSound('powerup');
      setTimeout(() => {
        powerUp.remove();
      }, 2000);
    }

    function getQuestionsByDifficulty(allQuestions) {
      const filtered = allQuestions.filter(q => {
        if (selectedDifficulty === 'easy') return q.difficulty === 'easy';
        if (selectedDifficulty === 'medium') return q.difficulty === 'easy' || q.difficulty === 'medium';
        if (selectedDifficulty === 'hard') return true; // Include all difficulties
      });
      // Sort by difficulty for progression
      if (selectedDifficulty === 'hard') {
        filtered.sort((a, b) => {
          const order = {
            'easy': 0,
            'medium': 1,
            'hard': 2
          };
          return order[a.difficulty] - order[b.difficulty];
        });
      }
      return filtered;
    }

    function startGame(mode) {
      currentMode = mode;
      currentQuestionIndex = 0;
      score = 0;
      if (questions.length > 0 && questions[0].type === 'translation') {
        timer = selectedDifficulty === 'easy' ? 120 : selectedDifficulty === 'medium' ? 90 : 60;
      } else {
        timer = selectedDifficulty === 'easy' ? 60 : selectedDifficulty === 'medium' ? 45 : 30;
      }      
      selectedMatches = [];
      answersHistory = [];
      // Set questions based on mode and difficulty
      let allQuestions = [];
      switch (mode) {
        case 'vocabulary':
          allQuestions = [...vocabularyQuestions];
          break;
        case 'grammar':
          allQuestions = [...grammarQuestions];
          break;
        case 'reading':
          allQuestions = [...readingQuestions];
          break;
        case 'translation':
          allQuestions = [...translationQuestions];
          break;
        case 'matching':
          allQuestions = [...matchingQuestions];
          break;
      }
      questions = getQuestionsByDifficulty(allQuestions);
      // Shuffle within difficulty groups if not hard mode
      if (selectedDifficulty !== 'hard') {
        questions = questions.sort(() => Math.random() - 0.5);
      }
      showScreen('game-screen');
      updateStats();
      loadQuestion();
      startTimer();
      playSound('click');
    }

    function loadQuestion() {
      if (currentQuestionIndex >= questions.length) {
        endGame();
        return;
      }
      const question = questions[currentQuestionIndex];
      if (question.type === 'translation') {
        timer = selectedDifficulty === 'easy' ? 120 : selectedDifficulty === 'medium' ? 90 : 60;
       } else {
        timer = selectedDifficulty === 'easy' ? 60 : selectedDifficulty === 'medium' ? 45 : 30;
       }
      document.getElementById('question-text').textContent = question.question;
      // Show difficulty indicator
      const indicator = document.getElementById('difficulty-indicator');
      indicator.textContent = question.difficulty ? question.difficulty.toUpperCase() : 'MEDIUM';
      indicator.style.background = question.difficulty === 'easy' ? '#4CAF50' :
        question.difficulty === 'hard' ? '#F44336' : '#2196F3';
      // Clear previous content
      document.getElementById('options-container').innerHTML = '';
      document.getElementById('sentence-builder').style.display = 'none';
      document.getElementById('translation-area').style.display = 'none';
      document.getElementById('matching-area').style.display = 'none';
      document.getElementById('feedback').style.display = 'none';
      // Hide check button initially
      document.querySelector('.controls .btn').style.display = 'none';
      if (question.type === 'sentence-builder') {
        setupSentenceBuilder(question);
      } else if (question.type === 'translation') {
        setupTranslation(question);
      } else if (question.type === 'matching') {
        setupMatching(question);
      } else {
        setupMultipleChoice(question);
      }
      updateStats();
    }

    function setupMultipleChoice(question) {
      const optionsContainer = document.getElementById('options-container');
      question.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'option-btn';
        button.textContent = option;
        button.onclick = () => selectAnswer(index);
        optionsContainer.appendChild(button);
      });
    }

    function setupSentenceBuilder(question) {
      document.getElementById('sentence-builder').style.display = 'block';
      document.querySelector('.controls .btn').style.display = 'inline-block';
      const wordBank = document.getElementById('word-bank');
      const sentenceArea = document.getElementById('sentence-area');
      wordBank.innerHTML = '';
      sentenceArea.innerHTML = '<span style="color: #666; font-style: italic;">Click Words to Build Sentence...</span>';
      currentSentence = [];
      question.words.forEach(word => {
        const wordCard = document.createElement('div');
        wordCard.className = 'word-card';
        wordCard.textContent = word;
        wordCard.onclick = () => addWordToSentence(word, wordCard);
        wordBank.appendChild(wordCard);
      });
    }

    function setupTranslation(question) {
      document.getElementById('translation-area').style.display = 'block';
      document.querySelector('.controls .btn').style.display = 'inline-block';
      document.getElementById('chinese-text').textContent = question.chinese;
      document.getElementById('translation-input').value = '';
      document.getElementById('translation-input').focus();
    }

    function setupMatching(question) {
      document.getElementById('matching-area').style.display = 'block';
      document.querySelector('.controls .btn').style.display = 'inline-block';
      const leftColumn = document.getElementById('left-column');
      const rightColumn = document.getElementById('right-column');
      // Clear previous content but keep headers
      leftColumn.innerHTML = '<h3>Words</h3>';
      rightColumn.innerHTML = '<h3>Meanings</h3>';
      selectedMatches = [];
      // Shuffle the pairs
      const shuffledPairs = [...question.pairs].sort(() => Math.random() - 0.5);
      const shuffledMeanings = [...question.pairs].map(p => p.meaning).sort(() => Math.random() - 0.5);
      // Add words to left column
      shuffledPairs.forEach((pair, index) => {
        const wordItem = document.createElement('div');
        wordItem.className = 'match-item';
        wordItem.textContent = pair.word;
        wordItem.dataset.word = pair.word;
        wordItem.onclick = () => selectMatch(wordItem, 'word');
        leftColumn.appendChild(wordItem);
      });
      // Add meanings to right column
      shuffledMeanings.forEach((meaning, index) => {
        const meaningItem = document.createElement('div');
        meaningItem.className = 'match-item';
        meaningItem.textContent = meaning;
        meaningItem.dataset.meaning = meaning;
        meaningItem.onclick = () => selectMatch(meaningItem, 'meaning');
        rightColumn.appendChild(meaningItem);
      });
    }

    function selectMatch(element, type) {
      if (element.classList.contains('matched')) return;
      playSound('click');
      // Remove previous selections of the same type
      document.querySelectorAll('.match-item.selected').forEach(item => {
        if ((type === 'word' && item.dataset.word) || (type === 'meaning' && item.dataset.meaning)) {
          item.classList.remove('selected');
        }
      });
      element.classList.add('selected');
      // Check if we have both word and meaning selected
      const selectedWord = document.querySelector('.match-item.selected[data-word]');
      const selectedMeaning = document.querySelector('.match-item.selected[data-meaning]');
      if (selectedWord && selectedMeaning) {
        // Check if it's a correct match
        const question = questions[currentQuestionIndex];
        const isCorrect = question.pairs.some(pair =>
          pair.word === selectedWord.dataset.word && pair.meaning === selectedMeaning.dataset.meaning
        );
        if (isCorrect) {
          selectedWord.classList.add('matched');
          selectedMeaning.classList.add('matched');
          selectedMatches.push({
            word: selectedWord.dataset.word,
            meaning: selectedMeaning.dataset.meaning
          });
          createPowerUp('üíØ', selectedWord.offsetLeft, selectedWord.offsetTop);
        } else {
          playSound('incorrect');
        }
        selectedWord.classList.remove('selected');
        selectedMeaning.classList.remove('selected');
      }
    }

    function addWordToSentence(word, wordCard) {
      if (wordCard.classList.contains('used')) return;
      playSound('click');
      wordCard.classList.add('used');
      currentSentence.push(word);
      const sentenceArea = document.getElementById('sentence-area');
      // Clear placeholder text if it exists
      if (currentSentence.length === 1) {
        sentenceArea.innerHTML = '';
      }
      const placedWord = document.createElement('span');
      placedWord.className = 'placed-word';
      placedWord.textContent = word;
      placedWord.onclick = () => removeWordFromSentence(word, placedWord, wordCard);
      sentenceArea.appendChild(placedWord);
    }

    function removeWordFromSentence(word, placedWord, wordCard) {
      playSound('click');
      placedWord.remove();
      wordCard.classList.remove('used');
      const index = currentSentence.indexOf(word);
      if (index > -1) {
        currentSentence.splice(index, 1);
      }
      // Add placeholder text back if sentence is empty
      if (currentSentence.length === 0) {
        const sentenceArea = document.getElementById('sentence-area');
        sentenceArea.innerHTML = '<span style="color: #666; font-style: italic;">Click Words to Build Sentence...</span>';
      }
    }

    function checkAnswer() {
      const question = questions[currentQuestionIndex];
      let isCorrect = false;
      let userAnswer = '';
      if (question.type === 'sentence-builder') {
        userAnswer = currentSentence.join(' ');
        isCorrect = JSON.stringify(currentSentence.slice(0, question.correctSentence.length)) === JSON.stringify(question.correctSentence);
      } else if (question.type === 'translation') {
        userAnswer = document.getElementById('translation-input').value.trim();
        isCorrect = question.correctAnswers.some(answer =>
          answer.toLowerCase() === userAnswer.toLowerCase() ||
          answer.toLowerCase().replace(/[.,!?]/g, '') === userAnswer.toLowerCase().replace(/[.,!?]/g, '')
        );
      } else if (question.type === 'matching') {
        userAnswer = `Matched ${selectedMatches.length} pairs`;
        isCorrect = selectedMatches.length === question.pairs.length;
      }
      if (isCorrect) {
        score += 15;
        createPowerUp('üéâ+15', 400, 200);
        playSound('correct');
      } else {
        playSound('incorrect');
      }
      // Store answer for review
      answersHistory.push({
        question: question.question,
        userAnswer: userAnswer,
        correctAnswer: question.type === 'sentence-builder' ? question.correctSentence.join(' ') : question.type === 'translation' ? question.correctAnswers[0] : question.type === 'matching' ? 'All pairs matched correctly' : question.options[question.correct],
        isCorrect: isCorrect,
        explanation: question.explanation
      });
      showFeedback(isCorrect, question.explanation);
      updateStats();
      // Show next button
      document.querySelector('.controls .btn:nth-child(2)').style.display = 'inline-block';
    }

    function selectAnswer(selectedIndex) {
      const question = questions[currentQuestionIndex];
      const buttons = document.querySelectorAll('.option-btn');
      buttons.forEach((button, index) => {
        button.disabled = true;
        if (index === question.correct) {
          button.classList.add('correct');
        } else if (index === selectedIndex) {
          button.classList.add('incorrect');
        }
      });
      const isCorrect = selectedIndex === question.correct;
      if (isCorrect) {
        score += 10;
        createPowerUp('üî•+10', 400, 200);
        playSound('correct');
      } else {
        playSound('incorrect');
      }
      // Store answer for review
      answersHistory.push({
        question: question.question,
        userAnswer: question.options[selectedIndex],
        correctAnswer: question.options[question.correct],
        isCorrect: isCorrect,
        explanation: question.explanation
      });
      showFeedback(isCorrect, question.explanation);
      updateStats();
      // Show next button
      document.querySelector('.controls .btn:nth-child(2)').style.display = 'inline-block';
    }

    function showFeedback(isCorrect, explanation) {
      const feedback = document.getElementById('feedback');
      feedback.style.display = 'block';
      feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = `${isCorrect ? 'üèÜ Excellent!' : 'üí™ Try again!'} ${explanation}`;
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        const nextQuestion = questions[currentQuestionIndex];
        if (nextQuestion.type === 'translation') {
          // Double Time
          timer = selectedDifficulty === 'easy' ? 120 : selectedDifficulty === 'medium' ? 90 : 60;
        } else {
          // Remain the original setting for the others
          timer = selectedDifficulty === 'easy' ? 60 : selectedDifficulty === 'medium' ? 45 : 30;
        }
      }      
      // Hide next button
      document.querySelector('.controls .btn:nth-child(2)').style.display = 'none';
      loadQuestion();
    }

    function updateStats() {
      document.getElementById('score').textContent = score;
      document.getElementById('question-num').textContent = Math.min(currentQuestionIndex + 1, questions.length);
      document.getElementById('timer').textContent = timer;
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        timer--;
        updateStats();
        if (timer <= 0) {
          nextQuestion();
        }
      }, 1000);
    }

    function generateReview() {
      const reviewContent = document.getElementById('review-content');
      reviewContent.innerHTML = '';
      answersHistory.forEach((item, index) => {
        const reviewItem = document.createElement('div');
        reviewItem.className = 'review-item';
        const statusClass = item.isCorrect ? 'correct' : 'incorrect';
        const statusText = item.isCorrect ? '‚úì Correct' : '‚úó Incorrect';
        reviewItem.innerHTML = `
          <div class="review-question">
            Q${index + 1}: ${item.question}
            <span class="review-status ${statusClass}">${statusText}</span>
          </div>
          <div class="review-your-answer">Your answer: ${item.userAnswer}</div>
          ${!item.isCorrect ? `<div class="review-correct-answer">Correct answer: ${item.correctAnswer}</div>` : ''}
          <div style="color: #666; font-size: 0.95em; margin-top: 5px;">${item.explanation}</div>
        `;
        reviewContent.appendChild(reviewItem);
      });
    }

    function endGame() {
      clearInterval(timerInterval);
      playSound('gameOver');
      const finalScore = document.getElementById('final-score');
      const performanceMsg = document.getElementById('performance-msg');
      finalScore.textContent = `${score} POINTS!`;
      const maxScore = questions.length * (currentMode === 'translation' || currentMode === 'matching' ? 15 : 10);
      const percentage = Math.round((score / maxScore) * 100);
      if (percentage >= 90) {
        performanceMsg.textContent = "üèÜ Legendary! You're a speed eating master! Joey Chestnut would be proud! üå≠";
      } else if (percentage >= 80) {
        performanceMsg.textContent = "ü•á Champion level! Excellent work on competitive eating! üçï";
      } else if (percentage >= 70) {
        performanceMsg.textContent = "ü•à Great job! You're becoming a real food fighter! üçî";
      } else if (percentage >= 60) {
        performanceMsg.textContent = "ü•â Good effort! Keep practicing your English! üå∂Ô∏è";
      } else if (percentage >= 50) {
        performanceMsg.textContent = "üëç Nice try! Review your lessons and come back! üìö";
      } else {
        performanceMsg.textContent = "üí™ Don't give up! Practice makes perfect! üéØ";
      }
      // Generate review
      generateReview();
      showScreen('final-screen');
    }

    function showScreen(screenId) {
      document.querySelectorAll('.game-area').forEach(area => {
        area.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
    }

    function restartGame() {
      clearInterval(timerInterval);
      startGame(currentMode);
    }

    function showStartScreen() {
      clearInterval(timerInterval);
      showScreen('start-screen');
      playSound('click');
    }
  </script>
</body>

</html>
